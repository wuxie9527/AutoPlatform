<!-- 测试环境管理页面 - 新增功能模块 -->
<div class="main-content">
    <!-- 筛选区域 -->
    <div class="filter-panel">
        <div class="filter-row">
            <div class="filter-item">
                <label for="env-name">环境名称</label>
                <input type="text" id="env-name" class="form-control input-sm" placeholder="请输入环境名称">
            </div>
            <div class="filter-item">
                <label for="env-status">状态</label>
                <select id="env-status" class="form-control input-sm">
                    <option value="">全部状态</option>
                    <option value="1">启用</option>
                    <option value="0">禁用</option>
                </select>
            </div>
            <div class="filter-item">
                <label for="env-type">环境类型</label>
                <select id="env-type" class="form-control input-sm">
                    <option value="">全部类型</option>
                    <option value="1">开发环境</option>
                    <option value="2">测试环境</option>
                    <option value="3">预生产环境</option>
                </select>
            </div>
        </div>
        <div class="filter-actions">
            <button type="button" class="btn btn-default btn-sm btn-outline">
                <i class="fa fa-refresh"></i> 重置
            </button>
            <button type="button" class="btn btn-primary btn-sm">
                <i class="fa fa-search"></i> 查询
            </button>
        </div>
    </div>

    <!-- 数据表格区域 -->
    <div class="main-panel">
        <!-- 操作按钮区域 -->
        <div class="table-actions">
            <div>
                <button type="button" class="btn btn-primary btn-sm" id="add-env-btn">
                    <i class="fa fa-plus"></i> 新增环境
                </button>
                <button type="button" class="btn btn-default btn-sm btn-outline">
                    <i class="fa fa-upload"></i> 批量导入
                </button>
                <button type="button" class="btn btn-default btn-sm btn-outline">
                    <i class="fa fa-download"></i> 导出
                </button>
            </div>
            <div>
                <button type="button" class="btn btn-default btn-sm btn-outline">
                    <i class="fa fa-refresh"></i> 刷新
                </button>
            </div>
        </div>

        <!-- 表格数据区域 -->
        <div class="table-responsive">
            <table class="data-table">
                <thead>
                    <tr>
                        <th class="select-column">
                            <input type="checkbox" id="select-all" class="select-checkbox">
                        </th>
                        <th width="80">环境ID</th>
                        <th width="120">环境名称</th>
                        <th width="100">环境类型</th>
                        <th width="150">测试对象</th>
                        <th width="150">数据库配置</th>
                        <th width="100">状态</th>
                        <th width="150">创建时间</th>
                        <th width="200">操作</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="select-column">
                            <input type="checkbox" class="select-checkbox env-select" data-id="201">
                        </td>
                        <td>201</td>
                        <td>用户中心-测试环境</td>
                        <td><span class="label label-primary">测试环境</span></td>
                        <td>
                            <span class="badge">API服务</span>
                            <span class="badge">Web服务</span>
                        </td>
                        <td>
                            <span class="badge">MySQL-主库</span>
                            <span class="badge">Redis-缓存</span>
                        </td>
                        <td><span class="status-badge status-active">启用</span></td>
                        <td>2026-02-10 14:30:15</td>
                        <td>
                            <div class="action-box">
                                <div class="action-item">
                                    <i class="fa fa-pencil action-icon"></i>
                                    <span class="action-text">修改</span>
                                </div>
                                <div class="action-item">
                                    <i class="fa fa-copy action-icon"></i>
                                    <span class="action-text">复制</span>
                                </div>
                                <div class="action-item">
                                    <i class="fa fa-trash action-icon"></i>
                                    <span class="action-text">删除</span>
                                </div>
                                <div class="test-btn">
                                    连接测试
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

    <!-- 新增环境模态框 -->
    <div class="modal fade" id="addEnvModal" tabindex="-1" role="dialog" aria-labelledby="addEnvModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="addEnvModalLabel">新增测试环境</h4>
            </div>
            <div class="modal-body">
                <form id="add-env-form">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="new-env-name">环境名称 *</label>
                                <input type="text" class="form-control" id="new-env-name" placeholder="请输入环境名称" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="new-env-type">环境类型 *</label>
                                <select class="form-control" id="new-env-type" required>
                                    <option value="">请选择环境类型</option>
                                    <option value="1">开发环境</option>
                                    <option value="2">测试环境</option>
                                    <option value="3">预生产环境</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 测试对象配置区域 -->
                    <div class="form-group">
                        <label>测试对象配置</label>
                        <div class="test-targets-container">
                            <div class="test-target-item panel panel-default">
                                <div class="panel-heading">
                                    <h5 class="panel-title">测试对象 #1</h5>
                                    <button type="button" class="btn btn-xs btn-danger remove-test-target">
                                        <i class="fa fa-times"></i>
                                    </button>
                                </div>
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>对象名称</label>
                                                <input type="text" class="form-control test-target-name" placeholder="如：API服务、Web服务" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>访问地址</label>
                                                <input type="text" class="form-control test-target-url" placeholder="如：http://api.example.com" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>端口号</label>
                                                <input type="number" class="form-control test-target-port" placeholder="如：8080" min="1" max="65535">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>协议类型</label>
                                                <select class="form-control test-target-protocol">
                                                    <option value="http">HTTP</option>
                                                    <option value="https">HTTPS</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-default btn-sm" id="add-test-target">
                            <i class="fa fa-plus"></i> 添加测试对象
                        </button>
                    </div>

                    <!-- 数据库配置区域 -->
                    <div class="form-group">
                        <label>数据库配置</label>
                        <div class="database-configs-container">
                            <div class="database-config-item panel panel-default">
                                <div class="panel-heading">
                                    <h5 class="panel-title">数据库配置 #1</h5>
                                    <button type="button" class="btn btn-xs btn-danger remove-database-config">
                                        <i class="fa fa-times"></i>
                                    </button>
                                </div>
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>数据库类型</label>
                                                <select class="form-control database-type" required>
                                                    <option value="">请选择数据库类型</option>
                                                    <option value="mysql">MySQL</option>
                                                    <option value="postgresql">PostgreSQL</option>
                                                    <option value="redis">Redis</option>
                                                    <option value="mongodb">MongoDB</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>连接名称</label>
                                                <input type="text" class="form-control database-name" placeholder="如：主库、缓存库" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>主机地址</label>
                                                <input type="text" class="form-control database-host" placeholder="如：localhost" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>端口号</label>
                                                <input type="number" class="form-control database-port" placeholder="如：3306" min="1" max="65535" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>用户名</label>
                                                <input type="text" class="form-control database-username" placeholder="数据库用户名" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>密码</label>
                                                <input type="password" class="form-control database-password" placeholder="数据库密码" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-default btn-sm" id="add-database-config">
                            <i class="fa fa-plus"></i> 添加数据库配置
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="save-env-btn">保存</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        // 新增环境按钮点击事件
        $('#add-env-btn').click(function() {
            $('#addEnvModal').modal('show');
        });

        // 添加测试对象
        $('#add-test-target').click(function() {
            var index = $('.test-target-item').length + 1;
            var newItem = `
                <div class="test-target-item panel panel-default">
                    <div class="panel-heading">
                        <h5 class="panel-title">测试对象 #${index}</h5>
                        <button type="button" class="btn btn-xs btn-danger remove-test-target">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>对象名称</label>
                                    <input type="text" class="form-control test-target-name" placeholder="如：API服务、Web服务" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>访问地址</label>
                                    <input type="text" class="form-control test-target-url" placeholder="如：http://api.example.com" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>端口号</label>
                                    <input type="number" class="form-control test-target-port" placeholder="如：8080" min="1" max="65535">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>协议类型</label>
                                    <select class="form-control test-target-protocol">
                                        <option value="http">HTTP</option>
                                        <option value="https">HTTPS</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            $('.test-targets-container').append(newItem);
        });

        // 删除测试对象
        $(document).on('click', '.remove-test-target', function() {
            if ($('.test-target-item').length > 1) {
                $(this).closest('.test-target-item').remove();
                // 重新编号
                $('.test-target-item').each(function(index) {
                    $(this).find('.panel-title').text('测试对象 #' + (index + 1));
                });
            } else {
                alert('至少需要保留一个测试对象');
            }
        });

        // 添加数据库配置
        $('#add-database-config').click(function() {
            var index = $('.database-config-item').length + 1;
            var newItem = `
                <div class="database-config-item panel panel-default">
                    <div class="panel-heading">
                        <h5 class="panel-title">数据库配置 #${index}</h5>
                        <button type="button" class="btn btn-xs btn-danger remove-database-config">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>数据库类型</label>
                                    <select class="form-control database-type" required>
                                        <option value="">请选择数据库类型</option>
                                        <option value="mysql">MySQL</option>
                                        <option value="postgresql">PostgreSQL</option>
                                        <option value="redis">Redis</option>
                                        <option value="mongodb">MongoDB</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>连接名称</label>
                                    <input type="text" class="form-control database-name" placeholder="如：主库、缓存库" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>主机地址</label>
                                    <input type="text" class="form-control database-host" placeholder="如：localhost" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>端口号</label>
                                    <input type="number" class="form-control database-port" placeholder="如：3306" min="1" max="65535" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>用户名</label>
                                    <input type="text" class="form-control database-username" placeholder="数据库用户名" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>密码</label>
                                    <input type="password" class="form-control database-password" placeholder="数据库密码" required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            $('.database-configs-container').append(newItem);
        });

        // 删除数据库配置
        $(document).on('click', '.remove-database-config', function() {
            if ($('.database-config-item').length > 1) {
                $(this).closest('.database-config-item').remove();
                // 重新编号
                $('.database-config-item').each(function(index) {
                    $(this).find('.panel-title').text('数据库配置 #' + (index + 1));
                });
            } else {
                alert('至少需要保留一个数据库配置');
            }
        });

        // 保存环境配置
        $('#save-env-btn').click(function() {
            var envData = {
                name: $('#new-env-name').val(),
                type: $('#new-env-type').val(),
                testTargets: [],
                databases: []
            };

            // 收集测试对象数据
            $('.test-target-item').each(function() {
                var targetData = {
                    name: $(this).find('.test-target-name').val(),
                    url: $(this).find('.test-target-url').val(),
                    protocol: $(this).find('.test-target-protocol').val()
                };
                envData.testTargets.push(targetData);
            });

            // 收集数据库配置数据
            $('.database-config-item').each(function() {
                var dbData = {
                    type: $(this).find('.database-type').val(),
                    name: $(this).find('.database-name').val(),
                    host: $(this).find('.database-host').val(),
                    port: $(this).find('.database-port').val(),
                    username: $(this).find('.database-username').val(),
                    password: $(this).find('.database-password').val()
                };
                envData.databases.push(dbData);
            });

            // 验证数据
            if (!envData.name || !envData.type) {
                alert('请填写完整的环境基本信息');
                return;
            }

            if (envData.testTargets.length === 0) {
                alert('请至少添加一个测试对象');
                return;
            }

            if (envData.databases.length === 0) {
                alert('请至少添加一个数据库配置');
                return;
            }

            console.log('保存环境数据:', envData);
            alert('环境配置保存成功！');
            $('#addEnvModal').modal('hide');
            // 这里可以添加实际的保存逻辑
        });

        // 模态框关闭时重置表单
        $('#addEnvModal').on('hidden.bs.modal', function() {
            $('#add-env-form')[0].reset();
            $('.test-target-item:gt(0)').remove();
            $('.database-config-item:gt(0)').remove();
        });
    });
</script>